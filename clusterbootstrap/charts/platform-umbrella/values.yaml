destServer: &dest https://kubernetes.default.svc
argocdNamespace: &ns openshift-gitops
appANamespace: &appA app-a

selfRepoURL: &selfRepo https://github.com/rh-fran6/htcdemo.git
selfRev: &selfRev main

argocd-apps:
  applications:
    - name: eso-operator-olm
      namespace: *ns
      project: platform
      annotations: { argocd.argoproj.io/sync-wave: "-2" }
      finalizers: [resources-finalizer.argocd.argoproj.io]
      source:
        repoURL: *selfRepo
        targetRevision: *selfRev
        path: operators/external-secrets-olm
      destination:
        server: *dest
        namespace: openshift-operators
      syncPolicy:
        automated: { prune: true, selfHeal: true }
        syncOptions: [CreateNamespace=true]

    - name: eso-instance
      namespace: *ns
      project: platform
      annotations: { argocd.argoproj.io/sync-wave: "0" }
      finalizers: [resources-finalizer.argocd.argoproj.io]
      source:
        repoURL: https://charts.external-secrets.io
        chart: external-secrets
        targetRevision: 0.9.x
        helm:
          values: |
            installCRDs: true
      destination:
        server: *dest
        namespace: external-secrets
      syncPolicy:
        automated: { prune: true, selfHeal: true }
        syncOptions: [CreateNamespace=true]

    - name: oauth-okta
      namespace: *ns
      project: platform
      annotations: { argocd.argoproj.io/sync-wave: "1" }
      finalizers: [resources-finalizer.argocd.argoproj.io]
      source:
        repoURL: *selfRepo
        targetRevision: *selfRev
        path: infra/oauth-okta
      destination:
        server: *dest
        namespace: *ns
      syncPolicy:
        automated: { prune: true, selfHeal: true }

    - name: cluster-autoscaler
      namespace: *ns
      project: platform
      annotations: { argocd.argoproj.io/sync-wave: "1" }
      finalizers: [resources-finalizer.argocd.argoproj.io]
      source:
        repoURL: *selfRepo
        targetRevision: *selfRev
        path: infra/cluster-autoscaler
      destination:
        server: *dest
        namespace: *ns
      syncPolicy:
        automated: { prune: true, selfHeal: true }

    - name: app-a-nginx
      namespace: *ns
      project: app-a
      annotations: { argocd.argoproj.io/sync-wave: "5" }
      finalizers: [resources-finalizer.argocd.argoproj.io]
      source:
        repoURL: https://charts.bitnami.com/bitnami
        chart: nginx
        targetRevision: 15.x.x
        helm:
          values: |
            service:
              type: ClusterIP
            replicaCount: 2
      destination:
        server: *dest
        namespace: *appA
      syncPolicy:
        automated: { prune: true, selfHeal: true }
        syncOptions: [CreateNamespace=true]
